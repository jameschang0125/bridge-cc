\documentclass{article}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{xcolor}
% trimmed unused packages
\usepackage{xparse}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage{colortbl}
\usepackage{nicematrix}
\usepackage{tikz}
\usetikzlibrary{backgrounds}
\makeatletter
% (intentionally left minimal; removed older unused demo commands)

% Color theme â€” My favorite 2
\definecolor{Fav2BidLabel}{HTML}{7C3AED}
\definecolor{Fav2BidDesc}{HTML}{A25DD0}
\definecolor{Fav2SubText}{HTML}{59709C}
\definecolor{Fav2SubExtra}{HTML}{23A0ED}
\definecolor{Fav2SubsubX}{HTML}{085D53}
\definecolor{Fav2SubsubY}{HTML}{34D399}
\colorlet{bidLabelColor}{Fav2BidLabel}
\colorlet{bidDescColor}{Fav2BidDesc}
\colorlet{subbidTextColor}{Fav2SubText}
\colorlet{subbidExtraColor}{Fav2SubExtra}
\colorlet{subsubXColor}{Fav2SubsubX}
\colorlet{subsubYColor}{Fav2SubsubY}
% removed unused GroupTint* definitions for conciseness

% palette for subtle group backgrounds tuned for text colors
\definecolor{GroupBGOne}{HTML}{FFDDB8}
\definecolor{GroupBGTwo}{HTML}{FFF1BF}
\definecolor{GroupBGThree}{HTML}{FFE4E6}
\definecolor{NeutralBG}{HTML}{DFCBB2}

\newcounter{bidGroupIndex}
\setcounter{bidGroupIndex}{0}
\gdef\bidGroupFillSpec{GroupBGOne}
% restore rowIndex to track emitted rows for shading
\newcounter{rowIndex}
\setcounter{rowIndex}{0}
\gdef\shadeCommands{}
% No-op during accumulation
\newcommand{\ShRight}[2]{}
\newcommand{\AddShadeForCurrentRow}{%
  \stepcounter{rowIndex}%
  \edef\currentColor{\bidGroupFillSpec}%
  \expandafter\xdef\csname rowColor\arabic{rowIndex}\endcsname{\currentColor}%
}

% Function to get color for current row
\def\getRowColor#1{%
  \def\result{NeutralBG}%
  % Parse shadeList to find color for row #1
  \expandafter\parseShadeList\shadeList,#1,\relax
}

\def\parseShadeList#1,#2,#3\relax{%
  \ifx#1\relax
    \let\result\result
  \else
    \ifnum#1=#2\relax
      \def\result{#3}%
    \else
      \expandafter\parseShadeList#3\relax
    \fi
  \fi
}

% Modify cell generation to include gradients
\def\makeGradientCell#1#2{%
  \tikz[baseline]{%
    \shade[left color=NeutralBG,right color=#2] (0,0) rectangle (\linewidth,1.2ex);%
    \node[anchor=west,text=black] at (0.05\linewidth,0.6ex) {#1};%
  }%
}
\makeatother
% Fixed-width columns for alignment
\newlength{\bidLeftWidth}\setlength{\bidLeftWidth}{.66\linewidth}
\newlength{\bidRightWidth}\setlength{\bidRightWidth}{.66\linewidth}
\newcommand{\BidRowStretch}{0.5}
% removed bidRowStrut

% Initialize global variables and counter
\newcounter{bidNeed}
\setcounter{bidNeed}{0}
\gdef\bidLabel{}\gdef\bidDesc{}

% bidsemi: use plain "\bid{A}[desc]" and "\subbid{<text>}[extra]"
\NewDocumentCommand{\bid}{m o}{%
  \gdef\bidLabel{#1}\setcounter{bidNeed}{1}%
  \IfValueTF{#2}{\gdef\bidDesc{#2}}{\gdef\bidDesc{}}%
  \stepcounter{bidGroupIndex}%
  \ifnum\value{bidGroupIndex}>3\setcounter{bidGroupIndex}{1}\fi
  \ifnum\value{bidGroupIndex}=1\gdef\bidGroupFillSpec{GroupBGOne}\fi
  \ifnum\value{bidGroupIndex}=2\gdef\bidGroupFillSpec{GroupBGTwo}\fi
  \ifnum\value{bidGroupIndex}=3\gdef\bidGroupFillSpec{GroupBGThree}\fi
}
\NewDocumentCommand{\subbid}{m o}{%
  \ifnum\value{bidNeed}=1\relax
    \ifx\bidDesc\empty
      \def\bidLeftCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel}}}%
    \else
      \def\bidLeftCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel :}}{\ \texttt{\color{bidDescColor} \bidDesc}}}%
    \fi
    \setcounter{bidNeed}{0}%
  \else
    \def\bidLeftCell{}%
  \fi
  % advance row and append shading command for this row
  \AddShadeForCurrentRow
  {\makeGradientCell{\bidLeftCell}{\csname rowColor\arabic{rowIndex}\endcsname}} & {\makeGradientCell{\ttfamily {\color{subbidTextColor}#1}\IfValueT{#2}{{\texttt{\color{subbidTextColor}:}\ \texttt{\color{subbidExtraColor}#2}}}}{\csname rowColor\arabic{rowIndex}\endcsname}}\tabularnewline
}
% Command to output standalone bids (bids without subbids)
\NewDocumentCommand{\flushbid}{}{%
  \ifnum\value{bidNeed}=1\relax
    % advance row and append shading for this pending row
    \AddShadeForCurrentRow
    \ifx\bidDesc\empty
      {\makeGradientCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel}}}{\csname rowColor\arabic{rowIndex}\endcsname}} & {\makeGradientCell{}{\csname rowColor\arabic{rowIndex}\endcsname}}\\
    \else
      {\makeGradientCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel :}}{\ \texttt{\color{bidDescColor} \bidDesc}}}{\csname rowColor\arabic{rowIndex}\endcsname}} & {\makeGradientCell{}{\csname rowColor\arabic{rowIndex}\endcsname}}\\
    \fi
    \setcounter{bidNeed}{0}%
  \fi
}
% Sub-item under right column with indentation; X dark grey, Y light grey
\NewDocumentCommand{\subsubbid}{m o}{%
\ifnum\value{bidNeed}=1\relax
  \ifx\bidDesc\empty
    \def\bidLeftCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel}}}%
  \else
    \def\bidLeftCell{{\color{bidLabelColor}\texttt{\bfseries \bidLabel :}}{\texttt{\color{bidDescColor} \bidDesc}}}%
  \fi
  \setcounter{bidNeed}{0}%
\else
  \def\bidLeftCell{}%
\fi
% advance row and append shading for this row
\AddShadeForCurrentRow
{\makeGradientCell{\bidLeftCell}{\csname rowColor\arabic{rowIndex}\endcsname}} & {\makeGradientCell{\ttfamily{\color{subbidTextColor}\phantom{oooo}#1}\IfValueT{#2}{{\texttt{\color{subbidTextColor}:}\ \texttt{\color{subbidExtraColor} #2}}}}{\csname rowColor\arabic{rowIndex}\endcsname}}\tabularnewline
}
\newenvironment{bidsemi}{%
  \begingroup
  \par\ttfamily\parskip=0pt\parindent=0pt%
  \setcounter{bidNeed}{0}\gdef\bidLabel{}\gdef\bidDesc{}%
  \setcounter{rowIndex}{0}\gdef\shadeList{}%
  \renewcommand{\arraystretch}{\BidRowStretch}%
  \begin{NiceTabular}{@{}p{\bidLeftWidth}@{\hspace{0.0em}}p{\bidRightWidth}@{}}[corners]%
}{%
  \ifnum\value{bidNeed}=1\relax
    % advance row and append shading for final pending row
    \AddShadeForCurrentRow
    \ifx\bidDesc\empty
      {\cellcolor{NeutralBG}{\color{bidLabelColor}\texttt{\bfseries \bidLabel}}} & {\cellcolor{NeutralBG}}\\
    \else
      {\cellcolor{NeutralBG}{\color{bidLabelColor}\texttt{\bfseries \bidLabel :}}{\texttt{\color{bidDescColor} \bidDesc}}} & {\cellcolor{NeutralBG}}\\
    \fi
  \fi
  \CodeAfter
    % Remove overlay approach - will modify cells directly instead
  \end{NiceTabular}\par\endgroup%
}

% (intentionally left minimal; removed unused list/collapsible helpers)

\begin{document}

\section*{Simple two-column text}
\begin{bidsemi}
\bid{A}[desc A]
\subbid{A1}
\subbid{A2}[extra]
\subbid{A3}
\bid{B}[desc B]
\subbid{B1}[this is a very very looooooooooong extra text hahahahhahahaha]
\subsubbid{X}[Y]
\subbid{B2}
\bid{C}
\subbid{C1}
\subbid{C2}[detail]
\subsubbid{X}[Y]
\bid{D}
\flushbid
\bid{E}
\subbid{E1}
\end{bidsemi}

{\par\small\ttfamily
  \edef\ShadeDbg{\shadeCommands}%
  \noindent Debug shadeCommands: \detokenize\expandafter{\ShadeDbg}\par
}

\end{document}


